{
  "rules": {
    "users": {
      "$uid": {
        ".read": "auth != null",
        ".write": "auth != null && auth.uid === $uid",
        "contacts": { ".read": "$uid === auth.uid", ".write": "$uid === auth.uid" },
        // DÜZELTME: Sohbet listesine başkalarının yazmasına izin ver (Yeni mesaj gelince liste güncellensin diye)
        "conversations": { ".read": "$uid === auth.uid", ".write": "auth != null" },
        "presence": { ".read": "auth != null" },
        "groups": { ".write": "auth != null" }
      }
    },
    "userSearchIndex": {
      ".read": "auth != null",
      "$uid": {
        ".write": "auth != null && auth.uid === $uid"
      }
    },
    "dms": {
      "$dmId": {
        // DM'i sadece içindeki üyeler okuyabilir ve yazabilir
        ".read": "auth != null && $dmId.contains(auth.uid)",
        ".write": "auth != null && $dmId.contains(auth.uid)",
        "messages": { ".indexOn": "timestamp" }
      }
    },
    "groups": {
      ".read": false,
      "$groupId": {
        ".read": "data.child('meta/members').child(auth.uid).exists()",
        ".write": "data.child('meta/members').child(auth.uid).exists() || (!data.exists() && newData.child('meta/members').hasChild(auth.uid))"
      }
    },
    "typing": {
      "dm": {
        "$dmId": {
          ".read": "auth != null && $dmId.contains(auth.uid)",
          "$userId": { ".write": "auth != null && $userId === auth.uid" }
        }
      },
      "group": {
        "$groupId": {
          ".read": "auth != null && root.child('groups/' + $groupId + '/meta/members/' + auth.uid).exists()",
          "$userId": { ".write": "auth != null && $userId === auth.uid" }
        }
      }
    },
    "calls": {
      "$uid": {
        // DÜZELTME: Kişi kendi gelen aramalarını okur, herkes ona arama gönderebilir (yazabilir)
        ".read": "$uid === auth.uid",
        ".write": "auth != null"
      }
    },
    "challenges": { "$uid": { ".read": "$uid === auth.uid", "$challenger_game_id": { ".write": "auth != null" } } },
    "chess_games": {
      ".read": "auth != null",
      "$gameId": { ".write": "auth != null" }
    }
  }
}